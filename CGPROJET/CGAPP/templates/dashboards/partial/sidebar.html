{% load static %}

<div class="sidebar pe-4 pb-3" style="width: 250px; min-height: 100vh; position: fixed; left: 0; top: 0; background-color: var(--white-bg); z-index: 1000; overflow-y: auto;">
    <nav class="navbar navbar-light" style="background-color: var(--white-bg); flex-direction: column; align-items: flex-start;">
        <a href="{% url 'home' %}" class="navbar-brand mx-4 mb-3">
            <h3 class="text-primary">
                <img class="rounded-circle" src="{% static 'logo.png' %}" alt="Logo" style="width: 40px; height: 40px;">
            </h3>
        </a>

        <div class="d-flex align-items-center ms-4 mb-4">
            <div class="position-relative">
                {% if user.profile_picture %}
                    <img class="rounded-circle" src="{{ user.profile_picture.url }}" alt="{{ user.username }}" style="width: 40px; height: 40px; object-fit: cover;">
                {% else %}
                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; background-color: #00B8B5; color: white; font-weight: bold;">
                        {{ user.username|first|upper }}
                    </div>
                {% endif %}
                <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
            </div>
            <div class="ms-3">
                <h6 class="mb-0">{{ user.username }}</h6>
                <span>{{ user.date_joined|date }}</span>
            </div>
        </div>

        <div class="navbar-nav w-100">
            {% if user.role == 'gerant' %}
                <!-- Tableau de bord -->
                <a href="{% url 'dashboard_gerant' %}" class="nav-item nav-link mb-2 {% if request.resolver_match.url_name == 'dashboard_gerant' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt me-2"></i>Tableau de bord
                </a>

                <!-- Gestion des Produits -->
                <div class="nav-item mb-2">
                    <div class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#produitsCollapse" role="button">
                        <span><i class="fas fa-boxes me-2"></i>Produits</span>
                        <i class="fas fa-chevron-down small"></i>
                    </div>
                    <div class="collapse show" id="produitsCollapse">
                        <div class="bg-light rounded p-2 ms-3">
                            <a href="{% url 'liste_produits' %}" class="nav-link py-1 {% if request.resolver_match.url_name == 'liste_produits' %}text-primary fw-bold{% endif %}">
                                <i class="fas fa-list-ul me-2"></i>Liste
                            </a>
                            <a href="{% url 'ajouter_produit' %}" class="nav-link py-1 {% if request.resolver_match.url_name == 'ajouter_produit' %}text-primary fw-bold{% endif %}">
                                <i class="fas fa-plus-circle me-2"></i>Ajouter
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Gestion des Stocks -->
                <a href="{% url 'gestion_stocks_avancee' %}" class="nav-item nav-link mb-2 {% if request.resolver_match.url_name == 'gestion_stocks_avancee' %}active{% endif %}">
                    <i class="fas fa-warehouse me-2"></i>Stocks
                </a>

                <!-- Gestion du Personnel -->
                <div class="nav-item mb-2">
                    <div class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#personnelCollapse" role="button">
                        <span><i class="fas fa-users-cog me-2"></i>Personnel</span>
                        <i class="fas fa-chevron-down small"></i>
                    </div>
                    <div class="collapse show" id="personnelCollapse">
                        <div class="bg-light rounded p-2 ms-3">
                            <a href="{% url 'liste_serveurs' %}" class="nav-link py-1 {% if request.resolver_match.url_name == 'liste_serveurs' %}text-primary fw-bold{% endif %}">
                                <i class="fas fa-user-friends me-2"></i>Serveurs
                            </a>
                            <a href="{% url 'gestion_serveurs_avancee' %}" class="nav-link py-1 {% if request.resolver_match.url_name == 'gestion_serveurs_avancee' %}text-primary fw-bold{% endif %}">
                                <i class="fas fa-chart-line me-2"></i>Performances
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Analyse Financière -->
                <a href="{% url 'gestion_financiere_gerant' %}" class="nav-item nav-link mb-2 {% if request.resolver_match.url_name == 'gestion_financiere_gerant' %}active{% endif %}">
                    <i class="fas fa-chart-pie me-2"></i>Finances
                </a>

                <!-- Rapports -->
                <a href="{% url 'rapports_admin' %}" class="nav-item nav-link mb-2 {% if request.resolver_match.url_name == 'rapports_admin' %}active{% endif %}">
                    <i class="fas fa-file-alt me-2"></i>Rapports
                </a>

                <!-- Communication -->
                <a href="{% url 'communication_notifications' %}" class="nav-item nav-link mb-2 {% if request.resolver_match.url_name == 'communication_notifications' %}active{% endif %}">
                    <i class="fas fa-comments me-2"></i>Messages
                </a>

                <div class="dropdown-divider my-2"></div>


           {% elif user.role == 'client' %}
            <a href="{% url 'dashboard_client' %}" 
            class="nav-item nav-link {% if request.resolver_match.url_name == 'dashboard_client' %}active{% endif %}">
            <i class="fas fa-home me-2"></i>Dashboard
            </a>

            <a href="{% url 'produits' %}" 
            class="nav-item nav-link {% if request.resolver_match.url_name == 'produits' %}active{% endif %}">
            <i class="fas fa-shopping-bag me-2"></i>Achat
            </a>

            <a href="{% url 'panier' %}"  
            class="nav-item nav-link {% if request.resolver_match.url_name == 'panier' %}active{% endif %}">
            <i class="fas fa-shopping-cart me-2"></i>Panier
            </a>

            <a href="{% url 'historique_client' %}" 
            class="nav-item nav-link {% if request.resolver_match.url_name == 'historique_client' %}active{% endif %}">
            <i class="fas fa-history me-2"></i>Historiques
            </a>

            <a href="{% url 'contact' %}" 
            class="nav-item nav-link {% if request.resolver_match.url_name == 'contact' %}active{% endif %}">
            <i class="fas fa-headset me-2"></i>Support
            </a>

            <a href="{% url 'tableau_avis' %}" 
            class="nav-item nav-link {% if request.resolver_match.url_name == 'tableau_avis' %}active{% endif %}">
            <i class="fas fa-headset me-2"></i> tableau d'avis
            </a>


            {% elif user.role == 'admin' %}
                <a href="{% url 'dashboard_admin' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'dashboard_admin' %}active{% endif %}">
                    <i class="fa fa-home me-2"></i>Dashboard
                </a>

                <a href="{% url 'creer_gerant' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'creer_gerant' %}active{% endif %}">
                    <i class="fa fa-user-plus me-2"></i>Ajout Gérant
                </a>

                <a href="{% url 'creer_serveur' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'creer_serveur' %}active{% endif %}">
                    <i class="fa fa-user-plus me-2"></i>Ajout Serveur
                </a>

                <a href="{% url 'liste_utilisateurs' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'liste_utilisateurs' %}active{% endif %}">
                    <i class="fa fa-users me-2"></i>Liste utilisateurs
                </a>

                <a href="{% url 'historique_actions' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'historique_actions' %}active{% endif %}">
                    <i class="fa fa-history me-2"></i>Historique
                </a>

                <a href="{% url 'parametres_systeme' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'parametres_systeme' %}active{% endif %}">
                    <i class="fa fa-cogs me-2"></i>Paramètres
                </a>
                
                <a href="{% url 'liste_produits' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'liste_produits' %}active{% endif %}">
                    <i class="fa fa-box me-2"></i>Gestion Produits
                </a>

                <a href="{% url 'gestion_categories' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'gestion_categories' %}active{% endif %}">
                    <i class="fa fa-tags me-2"></i>Gestion Catégories
                </a>

                <a href="{% url 'liste_serveurs' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'liste_serveurs' %}active{% endif %}">
                    <i class="fa fa-user-friends me-2"></i>Gestion Serveurs
                </a>

                <a href="{% url 'gestion_commandes_admin' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'gestion_commandes_admin' %}active{% endif %}">
                    <i class="fa fa-receipt me-2"></i>Gestion Cmd
                </a>

                <a href="{% url 'gestion_stocks_avancee' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'gestion_stocks_avancee' %}active{% endif %}">
                    <i class="fa fa-warehouse me-2"></i>Gestion Stock
                </a>
            {% elif user.role == 'serveur' %}
                <a href="{% url 'dashboard_serveur' %}" 
                class="nav-item nav-link {% if request.resolver_match.url_name == 'dashboard_serveur' %}active{% endif %}">
                <i class="fa fa-home me-2"></i>Dashboard
                </a>

                <a href="{% url 'liste_produits_serveur' %}" 
                class="nav-item nav-link {% if request.resolver_match.url_name == 'liste_produits_serveur' %}active{% endif %}">
                <i class="fa fa-box me-2"></i>Listes Produits
                </a>

                <a href="{% url 'commandes_en_attente' %}" 
                class="nav-item nav-link {% if request.resolver_match.url_name == 'commandes_en_attente' %}active{% endif %}">
                <i class="fa fa-hourglass-half me-2"></i>Listes cmdes
                </a>

                <a href="{% url 'nouvelle_commande_serveur' %}" 
                class="nav-item nav-link {% if request.resolver_match.url_name == 'nouvelle_commande_serveur' %}active{% endif %}">
                <i class="fa fa-plus-circle me-2"></i>Ajout cmdes
                </a>

                <a href="{% url 'commandes_livrees_serveur' %}" 
                class="nav-item nav-link {% if request.resolver_match.url_name == 'commandes_livrees_serveur' %}active{% endif %}">
                <i class="fa fa-check-circle me-2"></i>Cmdes livrées
                </a>
            {% endif %}


             <a href="{% url 'profile' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                    <i class="fa fa-user-circle me-2"></i>Profil
                </a>

                <a href="{% url 'deconnexion' %}" class="nav-item nav-link text-danger">
                    <i class="fa fa-sign-out-alt me-2"></i>Déconnexion
                </a>

        </div>
    </nav>
</div>

<style>
:root {
    --yellow-canaan: #FDCB05;
    --sidebar-bg: #2c3e50;
    --sidebar-text: #ecf0f1;
    --sidebar-hover: #34495e;
    --sidebar-active: #3498db;
    --sidebar-submenu-bg: #1a252f;
    --sidebar-icon: #95a5a6;
    --dropdown-bg: #ffffff;
    --dropdown-hover-bg: #f8f9fa;
    --dropdown-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    --transition-speed: 0.2s;
    --teal-glacier: #00B8B5;
    --pink-swoosh: #E91E63;
    --black-shadow: #000000;
    --white-bg: #FFFFFF;
}

.sidebar {
    background-color: var(--sidebar-bg);
    color: var(--sidebar-text);
    box-shadow: 0 0.15rem 1.75rem 0 rgba(0, 0, 0, 0.2);
    width: 250px;
    z-index: 1038;
    transition: all 0.3s ease;
}

.sidebar .nav-link {
    color: var(--sidebar-text);
    border-radius: 0.35rem;
    margin: 0.25rem 0.5rem;
    padding: 0.6rem 1rem;
    transition: all 0.2s;
    font-weight: 500;
}

.sidebar .nav-link i {
    width: 1.2rem;
    text-align: center;
    margin-right: 0.5rem;
    color: var(--sidebar-icon);
}

.sidebar .nav-link:hover, 
.sidebar .nav-link:focus {
    background-color: var(--sidebar-hover);
    color: white;
}

.sidebar .nav-link:hover i,
.sidebar .nav-link:focus i {
    color: white;
}

.sidebar .nav-link.active,
.sidebar .nav-link.active i {
    background-color: var(--sidebar-active);
    color: white;
}

/* Style pour les sous-menus */
.sidebar .collapse .bg-light {
    background-color: var(--sidebar-submenu-bg) !important;
    border-radius: 0.35rem;
    margin: 0.25rem 0;
    padding: 0.25rem 0;
}

.sidebar .nav-link.py-1 {
    padding: 0.4rem 1rem 0.4rem 2rem;
    margin: 0.1rem 0.5rem;
    font-size: 0.9rem;
}

.sidebar .nav-link.py-1:hover,
.sidebar .nav-link.py-1:focus {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Animation pour les flèches des menus déroulants */
.sidebar [data-bs-toggle="collapse"]:after {
    display: inline-block;
    font-style: normal;
    font-variant: normal;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    content: '\f078';
    margin-left: auto;
    transition: transform 0.2s;
    font-size: 0.7rem;
}

.sidebar [aria-expanded="true"]:after {
    transform: rotate(-180deg);
}

/* Style pour le header du profil */
.sidebar .d-flex.align-items-center {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.sidebar .position-relative img {
    border: 2px solid var(--sidebar-active);
}

.sidebar h6 {
    color: white;
    margin-bottom: 0.2rem;
}

.sidebar small {
    color: var(--sidebar-icon);
    font-size: 0.75rem;
}

/* Style pour le séparateur */
.dropdown-divider {
    border-color: rgba(255, 255, 255, 0.1);
    margin: 1rem 0.5rem;
}

/* Styles pour les menus déroulants */
.dropdown-menu {
    background-color: var(--white-bg);
    border: none;
    border-radius: 0.5rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    margin-top: 0.5rem;
    padding: 0.5rem 0;
    min-width: 220px;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.2s ease;
    display: block;
    visibility: hidden;
}

.dropdown-menu.show {
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
}

.dropdown-item {
    padding: 0.5rem 1.5rem;
    color: #4a5568;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
}

.dropdown-item:hover, .dropdown-item:focus {
    background-color: var(--dropdown-hover-bg);
    color: #1a202c;
}

.dropdown-item i {
    width: 20px;
    margin-right: 0.75rem;
    color: #718096;
    transition: all 0.2s ease;
}

.dropdown-item:hover i {
    color: var(--teal-glacier);
}

.dropdown-divider {
    border-top: 1px solid #edf2f7;
    margin: 0.5rem 0;
}

/* Styles pour les flèches des menus déroulants */
.dropdown-toggle::after {
    transition: transform 0.2s ease;
    margin-left: auto;
}

.dropdown-toggle[aria-expanded="true"]::after {
    transform: rotate(-180deg);
}

/* Styles pour les éléments de menu actifs */
.nav-link {
    transition: all 0.3s ease;
    border-radius: 0.375rem;
    padding: 12px 15px;
    margin: 4px 10px;
    color: var(--black-shadow);
    position: relative;
    display: block;
    width: calc(100% - 20px);
}

.nav-link:hover {
    background-color: rgba(253, 203, 5, 0.15);
    color: var(--bs-body-color);
}

.nav-link.active {
    background-color: var(--teal-glacier);
    color: var(--white-bg);
    font-weight: 500;
}

.nav-link.active i {
    color: var(--white-bg);
}

/* Styles pour les sous-menus */
.dropdown-submenu {
    position: relative;
}

.dropdown-submenu > .dropdown-menu {
    top: 0;
    left: 100%;
    margin-top: -0.5rem;
    margin-left: 0.5rem;
}

/* Animation pour les sous-menus */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dropdown-menu {
    animation: fadeInUp 0.2s ease forwards;
}

.nav-link.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 70%;
    background-color: var(--yellow-canaan);
    border-radius: 0 4px 4px 0;
}

.nav-link.text-danger {
    color: var(--pink-swoosh) !important;
}

.nav-link.text-danger:hover {
    background-color: rgba(233, 30, 99, 0.15);
    color: var(--pink-swoosh) !important;
}

/* Ajustement pour le contenu principal */
.content {
    margin-left: 250px;
    width: calc(100% - 250px);
}
</style>